<!DOCTYPE html>
<html>
    <head>
		<title>Groove Display</title>
		
		<meta name="viewport" content="width=810, initial-scale=1.25">
		
		<!--   Other peoples JS libraries    -->
		<!--   midi.js package for sound   -->
		<script src="./js/MIDI/AudioDetect.js" type="text/javascript"></script>
		<script src="./js/MIDI/LoadPlugin.js" type="text/javascript"></script>
		<script src="./js/MIDI/Plugin.js" type="text/javascript"></script>
		<script src="./js/MIDI/Player.js" type="text/javascript"></script>
		<script src="./js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
		<!-- jasmid package midi package required by midi.js above -->
		<script src="./inc/jasmid/stream.js"></script>
		<script src="./inc/jasmid/midifile.js"></script>
		<script src="./inc/jasmid/replayer.js"></script>
		<!-- jsmidgen -->
		<script src="./js/jsmidgen.js" type="text/javascript"></script>
		<!-- extras -->
		<script src="./inc/Base64.js" type="text/javascript"></script>
		<script src="./inc/base64binary.js" type="text/javascript"></script>
		<!-- script to render ABC to an SVG image -->
		<script type="text/javascript" src="./js/abc2svg-1.js"></script>
		
		<!--   our custom JS  -->
		<script src="js/groove_utils.js"></script>
		
		
	    <link rel="stylesheet" type="text/css" href="css/groove_writer.css">
    </head>
    <body>
	<script>
			var GrooveData;  // global;
	
			// set up the page after it has fully loaded
			window.onload = function () {
				myGrooveUtils = new GrooveUtils();
			
				// load the groove from the URL data if it was passed in.
				GrooveData = myGrooveUtils.getGrooveDataFromUrlString(window.location.search);
				var abcNotation = myGrooveUtils.createABCFromGrooveData(GrooveData);
				var svgReturn = myGrooveUtils.renderABCtoSVG(abcNotation);
				
				document.getElementById('svgTarget').innerHTML = '<a href="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/?' + window.location.search + '">' + svgReturn.svg + '</a>';
				//document.write("<p><textarea cols=60 rows=30>" + abcNotation + "</textarea>");
				//document.write("<pre>" + JSON.stringify(GrooveData, null, 2) + "</pre>");
				
				myGrooveUtils.midiEventCallbacks.loadMidiDataEvent = function(myroot) { 
					var midiURL = myGrooveUtils.create_MIDIURLFromGrooveData(GrooveData, "our_MIDI");
					myGrooveUtils.loadMIDIFromURL(midiURL);
					myGrooveUtils.midiResetNoteHasChanged();
				}
			
				myGrooveUtils.AddMidiPlayerToPage("midiPlayer", GrooveData.notesPerMeasure);
				myGrooveUtils.oneTimeInitializeMidi();
			}
			
						
			
	</script>
	
	<div id="svgTarget" class=svgTarget></div>
	<div id="midiPlayer" style="width: 500px"></div>	