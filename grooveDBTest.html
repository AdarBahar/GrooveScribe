<!--  A widget for turning a multipart drum tab in to pretty printed sheet music with midi playback
-->

<!--   Other peoples JS libraries    -->
<!--   midi.js package for sound   -->
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/MIDI/AudioDetect.js" type="text/javascript"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/MIDI/LoadPlugin.js" type="text/javascript"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/MIDI/Plugin.js" type="text/javascript"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/MIDI/Player.js" type="text/javascript"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/Window/DOMLoader.XMLHttp.js" type="text/javascript"></script>
<!-- jasmid package midi package required by midi.js above -->
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./inc/jasmid/stream.js"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./inc/jasmid/midifile.js"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./inc/jasmid/replayer.js"></script>
<!-- jsmidgen -->
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/jsmidgen.js" type="text/javascript"></script>
<!-- extras -->
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./inc/Base64.js" type="text/javascript"></script>
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./inc/base64binary.js" type="text/javascript"></script>
<!-- script to render ABC to an SVG image -->
<script type="text/javascript" src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/abc2svg-1.js"></script>

<!--   our custom JS  -->
<script src="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./js/groove_utils.js"></script>

<link rel="stylesheet" type="text/css" href="https://b125c4f8bf7d89726feec9ab8202d31e0c8d14d8.googledrive.com/host/0B2wxVWzVoWGYfnB5b3VTekxyYUowVjZ5YVE3UllLaVk5dVd4TzF4Q2ZaUXVsazhNSTdRM1E/./css/groove_display.css">
   
<script>
	function generateGUID() {
		var d = new Date().getTime();
		var guid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
			var r = (d + Math.random()*16)%16 | 0;
			d = Math.floor(d/16);
			return (c=='x' ? r : (r&0x3|0x8)).toString(16);
		});
		return guid;
	};

	//var TabIn = {};
	//TabIn.tempo          =  <!--{$HasTempo|escape:'html'}-->;
	//TabIn.div            =  <!--{$HasDivision|escape:'html'}-->;
	//TabIn.measures       =  <!--{$HasMeasures|escape:'html'}-->;
	//TabIn.hihatTab       = '<!--{$HasHiHatTab|escape:'html'}-->';
	//TabIn.snareAccentTab = '<!--{$HasSnareAccentTab|escape:'html'}-->';
	//TabIn.snareOtherTab  = '<!--{$HasSnareOtherTab|escape:'html'}-->';
	//TabIn.kickTab        = '<!--{$HasKickTab|escape:'html'}-->';
	//TabIn.footOtherTab   = '<!--{$HasFootOtherTab|escape:'html'}-->';
	
	var TabIn = {};
	TabIn.tempo          =  90;
	TabIn.div            =  16;
	TabIn.measures       =  2;
	TabIn.hihatTab       = 'x---o---+---x---x---o---+---x---x---o---+---x---x---o---+---x---';
	TabIn.snareAccentTab = '--------O-------------------O-----------O---------------O-------';
	TabIn.snareOtherTab  = '--------------g-------------------g-----------g-----------------';
	TabIn.kickTab        = 'o---------------o---o---------------o-----------o---o---------o-';
	TabIn.footOtherTab   = '----------------------------------------------------------------';
	TabIn.notesPerTabMeasure = 32;

	document.write("<pre>" + 
				 "\n   tempo: " + TabIn.tempo +
				 "\n     div: " + TabIn.div +
				 "\nmeasures: " + TabIn.measures +
				 "\n     NPM: " + TabIn.notesPerTabMeasure +
				 "\n   hihat: " + TabIn.hihatTab       +
				 "\n snare A: " + TabIn.snareAccentTab +
				 "\n snare o: " + TabIn.snareOtherTab  +
				 "\n    kick: " + TabIn.kickTab        +
				 "\n  foot o: " + TabIn.footOtherTab   +
				 "</pre>");

	var myGrooveUtils = new GrooveUtils();	
	var myGrooveData = new myGrooveUtils.grooveData();
	
	
	myGrooveData.tempo = TabIn.tempo;
	myGrooveData.numberOfMeasures = TabIn.measures;
	myGrooveData.showMeasures = TabIn.measures;
	myGrooveData.notesPerMeasure = TabIn.notesPerTabMeasure;
	myGrooveData.sticking_array = myGrooveUtils.noteArraysFromURLData("Stickings", "", TabIn.notesPerTabMeasure, TabIn.measures);
	myGrooveData.hh_array = myGrooveUtils.noteArraysFromURLData("H", TabIn.hihatTab, TabIn.notesPerTabMeasure, TabIn.measures);
	myGrooveData.snare_array = myGrooveUtils.noteArraysFromURLData("S", TabIn.snareAccentTab, TabIn.notesPerTabMeasure, TabIn.measures);
	myGrooveData.kick_array = myGrooveUtils.noteArraysFromURLData("K", TabIn.kickTab, TabIn.notesPerTabMeasure, TabIn.measures);

	console.log(myGrooveData);
	
	var myGuid = generateGUID();
	var svgTargetId = "SVG-" + myGuid;
	var midiPlayerTargetId = "Player-" + myGuid;
	
	// spit out some HTML tags to hold the music and possibly the player
	document.write('' +
					'<div id="' + svgTargetId + '" class="svgTarget" style="display:inline-block"></div>\n' +
					'<div id="' + midiPlayerTargetId + '" style="width: 260px; display:inline-block; vertical-align: bottom"></div>\n');
					
	var abcNotation = myGrooveUtils.createABCFromGrooveData(myGrooveData);
	var svgReturn = myGrooveUtils.renderABCtoSVG(abcNotation);
	
	document.getElementById(svgTargetId).innerHTML = svgReturn.svg;
	
	myGrooveUtils.setGrooveData(myGrooveData);

	myGrooveUtils.AddMidiPlayerToPage(midiPlayerTargetId, myGrooveData.notesPerMeasure, true);
	myGrooveUtils.expandOrRetractMIDI_playback(true, false);  // make it small
	myGrooveUtils.oneTimeInitializeMidi();


</script>