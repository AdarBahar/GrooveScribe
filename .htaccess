# GrooveScribe Cache Control Configuration

# Serve index.php by default and route index.html to index.php (cache-busted HTML)
DirectoryIndex index.php index.html
RewriteEngine On
# Root requests
RewriteRule ^$ index.php [L]
# Any direct index.html requests
RewriteRule ^index\.html$ index.php [L]

# Set index.php as default directory index
DirectoryIndex index.php

# Disable caching for HTML files to ensure fresh content
<FilesMatch "\.(html|htm)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Disable caching for JavaScript files to ensure fresh code
<FilesMatch "\.(js)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Disable caching for CSS files to ensure fresh styles
<FilesMatch "\.(css)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Disable caching for PHP files
<FilesMatch "\.(php)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Allow longer caching for static assets that don't change often
<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=86400"
</FilesMatch>

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Force UTF-8 encoding
AddDefaultCharset UTF-8

# Prevent access to sensitive files
<Files ".htaccess">
    Order allow,deny
    Deny from all
</Files>

<Files ".env*">
    Order allow,deny
    Deny from all
</Files>

# Custom error pages (optional)
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html
